<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Christmas Tree Memories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  background: black;
  color: white;
  font-family: system-ui, sans-serif;
}
canvas { position: fixed; inset: 0; }

.photo {
  position: absolute;
  width: 90px;
  height: 90px;
  object-fit: cover;
  border: 4px solid gold;
  border-radius: 6px;
  cursor: pointer;
  transition: transform 0.3s ease;
}
.photo.open {
  transform: scale(2.5);
  z-index: 999;
}

#hint {
  position: fixed;
  bottom: 10px;
  width: 100%;
  text-align: center;
  font-size: 14px;
  opacity: 0.7;
}
</style>
</head>

<body>
<canvas id="bg"></canvas>
<div id="hint">‚úä Drag tree | ‚úåÔ∏è Open photo | üñ± Mouse always works</div>

<!-- MediaPipe (CPU-safe versions) -->
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/hands.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.3/camera_utils.min.js"></script>

<script>
/* ================= BACKGROUND ================= */
const canvas = document.getElementById("bg");
const ctx = canvas.getContext("2d");
function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
resize();
addEventListener("resize", resize);

const sparks = Array.from({ length: 700 }, () => ({
  x: Math.random() * canvas.width,
  y: Math.random() * canvas.height,
  r: Math.random() * 2 + 1
}));

function animateBg() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle = "gold";
  sparks.forEach(s => {
    s.y -= 0.4;
    if (s.y < 0) s.y = canvas.height;
    ctx.fillRect(s.x, s.y, s.r, s.r);
  });
  requestAnimationFrame(animateBg);
}
animateBg();

/* ================= IMAGES ================= */
const images = [
 "image1.jpeg","image2.jpeg","image3.jpeg","image4.jpeg","image5.jpeg",
 "image6.jpeg","image7.jpeg","image8.jpeg","image9.jpeg","image10.jpeg",
 "image11.jpeg","image12.jpeg","image13.jpeg","image14.jpeg","image15.jpeg"
];

let offsetX = 0, offsetY = 0;
const photos = [];

images.forEach(src => {
  const img = document.createElement("img");
  img.src = src;
  img.className = "photo";

  const level = Math.random();
  const spread = level * 320;
  img.dataset.x = innerWidth/2 + (Math.random()-0.5)*spread;
  img.dataset.y = innerHeight/2 + level*420 - 200;

  img.onclick = () => img.classList.toggle("open");

  document.body.appendChild(img);
  photos.push(img);
});

function updatePhotos() {
  photos.forEach(p => {
    p.style.left = (+p.dataset.x + offsetX) + "px";
    p.style.top  = (+p.dataset.y + offsetY) + "px";
  });
}
updatePhotos();

/* ================= MOUSE DRAG ================= */
let drag = false, lx=0, ly=0;
addEventListener("mousedown", e => {
  drag = true; lx=e.clientX; ly=e.clientY;
});
addEventListener("mouseup", ()=>drag=false);
addEventListener("mousemove", e => {
  if(!drag) return;
  offsetX += e.clientX-lx;
  offsetY += e.clientY-ly;
  lx=e.clientX; ly=e.clientY;
  updatePhotos();
});

/* ================= HAND TRACKING ================= */
const video = document.createElement("video");
video.style.display = "none";
document.body.appendChild(video);

let lastX=null, lastY=null;

const hands = new Hands({
  locateFile: file =>
    `https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4/${file}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 0,     // üî¥ IMPORTANT
  selfieMode: true,
  minDetectionConfidence: 0.6,
  minTrackingConfidence: 0.6
});

hands.onResults(results => {
  if (!results.multiHandLandmarks) return;
  const lm = results.multiHandLandmarks[0];
  const i = lm[8], m = lm[12];
  const x = i.x * innerWidth;
  const y = i.y * innerHeight;
  const dist = Math.hypot(i.x-m.x, i.y-m.y);

  // ‚úä fist ‚Üí move tree
  if (dist < 0.04 && lastX !== null) {
    offsetX += x-lastX;
    offsetY += y-lastY;
    updatePhotos();
  }

  // ‚úåÔ∏è open nearest
  if (dist > 0.08) {
    photos.forEach(p=>p.classList.remove("open"));
    photos.forEach(p=>{
      const r=p.getBoundingClientRect();
      if (Math.hypot(r.left+45-x,r.top+45-y)<60)
        p.classList.add("open");
    });
  }
  lastX=x; lastY=y;
});

const camera = new Camera(video, {
  onFrame: async () => {
    try { await hands.send({ image: video }); }
    catch(e){}
  },
  width: 640, height: 480
});

/* USER GESTURE REQUIRED */
document.body.addEventListener("click", async () => {
  try { await camera.start(); }
  catch {
    document.getElementById("hint").innerText =
      "Camera blocked ‚Äî mouse still works";
  }
},{once:true});
</script>
</body>
</html>
